---
import BaseLayout from '../layouts/BaseLayout.astro';
import Footer from '../components/Footer.astro';
import services from '../data/services.json';

// Filter only AI services
const aiServices = services.filter(s => s.category === 'AI');

// Group by owner
const ownerOrder = ['Sam Altman', 'Satya Nadella', 'Sundar Pichai', 'Elon Musk', 'Aravind Srinivas'];

const aiGroups = ownerOrder
  .map(owner => ({
    owner,
    services: aiServices.filter(s => s.owner === owner)
  }))
  .filter(group => group.services.length > 0);

// Calculate total if all cancelled
const totalMonthly = aiServices.reduce((sum, s) => sum + s.monthlyPrice, 0);
const totalAnnual = Math.round(totalMonthly * 12);
---

<BaseLayout title="Defund AI - A Targeted Strike">

  <section class="hero">
    <div class="accent-bar" aria-hidden="true"></div>
    <h1><span class="strike-label">TARGETED STRIKE:</span><br/><span class="headline-main">DEFUND AI</span></h1>
    <p class="subtext intro">Every major AI company is funded by billionaires who bent the knee. OpenAI, Google, Microsoft, xAI—they all took the money and made the pilgrimage.</p>
    <p class="subtext punch">This isn't about the free tier.<br/><strong>Stop using them entirely.</strong></p>
    <p class="subtext intro">Every query trains their models. Every prompt makes them stronger. Every login is a data point they sell to advertisers and governments.</p>
  </section>

  <div class="strike-header">
    <div class="accent-bar" aria-hidden="true"></div>
    <h2>Complete Withdrawal</h2>
    <p class="strike-message">Cancel paid subscriptions. Delete your accounts. Stop using the free tier. Run local models instead.</p>

    <div class="impact-stat">
      <span class="impact-number">${totalAnnual.toLocaleString()}</span>
      <span class="impact-label">/year taken back if you cancel all AI subscriptions below</span>
    </div>
  </div>

  <section class="ai-services">
    <div class="owner-groups">
      {aiGroups.map((group) => (
        <div class="owner-group">
          <h3 class="owner-name">{group.owner}</h3>
          <div class="owner-services">
            {group.services.map((service) => (
              <div class="service-item" data-id={service.id}>
                <label class="service-checkbox">
                  <input type="checkbox" value={service.id} data-price={service.monthlyPrice} />
                  <span class="service-name">{service.name}</span>
                  <span class="service-price">
                    {service.monthlyPrice > 0 ? `$${service.monthlyPrice.toFixed(2)}/mo` : ''}
                  </span>
                </label>
                <div class="inline-steps hidden">
                  <p class="service-reason">{service.reason}</p>
                  <h4>Cancel subscription:</h4>
                  <ol>
                    {service.cancelSteps.map((step) => <li>{step}</li>)}
                  </ol>
                  <a href={service.cancelUrl} target="_blank" rel="noopener noreferrer" class="cancel-link">
                    Cancel {service.name} <span class="sr-only">(opens in new tab)</span> →
                  </a>
                  <div class="delete-account">
                    <h4>Then delete your account:</h4>
                    <p>Don't just cancel—delete your data. Check their settings for "Delete account" or "Request data deletion."</p>
                  </div>
                  <div class="inline-alt">
                    <span class="alt-label">Use instead:</span>
                    <a href={service.alternative.url} target="_blank" rel="noopener">{service.alternative.name}</a>
                    <span class="alt-desc">— {service.alternative.description}</span>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  </section>

  <section class="savings-section hidden" aria-live="polite" aria-atomic="true">
    <p class="savings-highlight">Taking back <span id="annual-savings" class="amount">$0/year</span></p>
  </section>

  <section class="alternative-section">
    <div class="accent-bar" aria-hidden="true"></div>
    <h2>What to Use Instead</h2>
    <p class="alt-intro">You don't need Big Tech AI. Run models locally on your own machine.</p>

    <div class="alt-options">
      <div class="alt-card">
        <h3>Ollama</h3>
        <p>Run Llama, Mistral, and other open-source models locally. Free, private, no account needed.</p>
        <a href="https://ollama.ai" target="_blank" rel="noopener" class="alt-link">Get Ollama →</a>
      </div>
      <div class="alt-card">
        <h3>LM Studio</h3>
        <p>User-friendly app to run local AI models. Download models, chat privately.</p>
        <a href="https://lmstudio.ai" target="_blank" rel="noopener" class="alt-link">Get LM Studio →</a>
      </div>
      <div class="alt-card">
        <h3>Jan</h3>
        <p>Open-source ChatGPT alternative that runs 100% offline on your computer.</p>
        <a href="https://jan.ai" target="_blank" rel="noopener" class="alt-link">Get Jan →</a>
      </div>
    </div>
  </section>

  <section class="share-section">
    <div class="step-header">
      <span class="step-number" aria-hidden="true">→</span>
      <div class="step-info">
        <h3 class="step-title">Spread the Strike</h3>
        <p class="step-desc">Share this targeted action with others.</p>
      </div>
    </div>
    <div class="share-buttons" role="group" aria-label="Share options">
      <a href="#" id="share-whatsapp" class="share-btn share-whatsapp" target="_blank" rel="noopener">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
        WhatsApp
      </a>
      <a href="#" id="share-sms" class="share-btn share-sms">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
        Text
      </a>
      <a href="#" id="share-email" class="share-btn share-email">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
        Email
      </a>
      <button type="button" id="share-copy" class="share-btn share-copy">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
        Copy
      </button>
    </div>
    <span class="share-feedback hidden" id="share-feedback" role="status" aria-live="polite">Copied!</span>
    <p class="share-text hidden" id="share-text">I'm joining the AI strike. No more ChatGPT, Gemini, or Copilot—not even free. Every query trains their models and funds billionaires. Run local instead: ollama.ai. Join me: https://defundbillionaires.org/defund-ai</p>

    <div class="back-link">
      <a href="/">← Back to full Defund Billionaires list</a>
    </div>
  </section>

  <Footer slot="footer" />
</BaseLayout>

<style>
  .hero {
    text-align: left;
    padding: 2rem 1rem 1.5rem;
    max-width: 700px;
    margin: 0 auto;
  }

  .accent-bar {
    width: 80px;
    height: 4px;
    background: linear-gradient(90deg, #dc2626, #ea580c);
    margin: 0 0 1.5rem;
    border-radius: 2px;
  }

  h1 {
    font-size: 2.25rem;
    font-weight: 900;
    letter-spacing: -0.04em;
    line-height: 0.9;
    margin-bottom: 1.5rem;
  }

  .strike-label {
    display: block;
    font-size: 0.5em;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: #dc2626;
    margin-bottom: 0.5rem;
  }

  .headline-main {
    display: block;
  }

  @media (min-width: 400px) {
    h1 {
      font-size: 3rem;
    }
  }

  @media (min-width: 640px) {
    .hero {
      padding: 3rem 2rem 2rem;
    }

    h1 {
      font-size: 4rem;
    }
  }

  .subtext {
    font-size: 1.1rem;
    color: var(--muted);
    max-width: 600px;
    margin: 0;
    line-height: 1.6;
  }

  .subtext.intro {
    margin-bottom: 1rem;
  }

  .subtext.punch {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text);
    margin: 1.5rem 0;
  }

  .strike-header {
    background: #0f172a;
    margin-left: -1rem;
    margin-right: -1rem;
    padding: 2.5rem 1rem 2rem;
    text-align: center;
  }

  .strike-header .accent-bar {
    margin: 0 auto 1.5rem;
    background: linear-gradient(90deg, #f97316, #dc2626);
  }

  .strike-header h2 {
    color: white;
    font-size: 1.75rem;
    font-weight: 800;
    letter-spacing: -0.02em;
    margin-bottom: 1rem;
  }

  .strike-message {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.1rem;
    max-width: 500px;
    margin: 0 auto 1.5rem;
  }

  .impact-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
  }

  .impact-number {
    font-size: 2.5rem;
    font-weight: 800;
    color: #f97316;
    font-family: 'Inter', sans-serif;
  }

  .impact-label {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
  }

  @media (min-width: 640px) {
    .strike-header {
      margin-left: -1.5rem;
      margin-right: -1.5rem;
      padding: 3rem 1.5rem 2.5rem;
    }

    .strike-header h2 {
      font-size: 2.25rem;
    }

    .impact-number {
      font-size: 3rem;
    }
  }

  @media (min-width: 1024px) {
    .strike-header {
      margin-left: -2rem;
      margin-right: -2rem;
    }
  }

  .ai-services {
    padding: 2rem 1rem;
    max-width: 900px;
    margin: 0 auto;
  }

  .owner-groups {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  @media (min-width: 480px) {
    .owner-groups {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 768px) {
    .owner-groups {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .owner-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .owner-name {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text);
    margin: 0;
    padding-bottom: 0.25rem;
    border-bottom: 2px solid #dc2626;
  }

  .owner-services {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
  }

  .service-checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 0.5rem;
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 8px;
  }

  .service-checkbox:hover {
    background: rgba(0, 0, 0, 0.03);
  }

  .service-checkbox.selected {
    background: rgba(4, 120, 87, 0.1);
  }

  .service-checkbox.selected .service-name {
    color: var(--success);
    font-weight: 600;
  }

  .service-checkbox input {
    width: 1.125rem;
    height: 1.125rem;
    accent-color: #dc2626;
    flex-shrink: 0;
  }

  .service-checkbox .service-name {
    flex: 1;
    font-weight: 500;
    font-size: 1rem;
  }

  .service-checkbox .service-price {
    font-size: 0.9rem;
    color: var(--muted);
  }

  .service-item {
    display: flex;
    flex-direction: column;
  }

  .inline-steps {
    padding: 1rem 0.5rem 1rem 2.25rem;
    animation: slideDown 0.2s ease;
  }

  .inline-steps.hidden {
    display: none;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .service-reason {
    font-size: 0.95rem;
    color: var(--muted);
    font-style: italic;
    margin: 0 0 1rem 0;
    padding-left: 0.75rem;
    border-left: 2px solid #dc2626;
  }

  .inline-steps h4 {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text);
    margin: 0 0 0.5rem 0;
  }

  .inline-steps ol {
    margin: 0 0 0.75rem 0;
    padding-left: 1.25rem;
    color: var(--muted);
  }

  .inline-steps li {
    font-size: 0.95rem;
    margin-bottom: 0.25rem;
  }

  .cancel-link {
    display: inline-block;
    background: #dc2626;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.95rem;
    font-weight: 600;
    text-decoration: none;
  }

  .cancel-link:hover {
    opacity: 0.9;
    text-decoration: none;
  }

  .delete-account {
    margin-top: 1rem;
    padding: 0.75rem;
    background: rgba(220, 38, 38, 0.05);
    border-radius: 6px;
  }

  .delete-account h4 {
    color: #dc2626;
  }

  .delete-account p {
    margin: 0;
    font-size: 0.9rem;
    color: var(--muted);
  }

  .inline-alt {
    font-size: 0.9rem;
    color: var(--muted);
    margin-top: 1rem;
  }

  .inline-alt .alt-label {
    font-weight: 600;
    color: var(--success);
  }

  .inline-alt a {
    color: var(--success);
    font-weight: 600;
  }

  .inline-alt .alt-desc {
    display: block;
    margin-top: 0.125rem;
  }

  .savings-section {
    text-align: center;
    padding: 1.5rem;
    background: var(--card-bg);
    border: 2px solid var(--success);
    border-radius: 12px;
    margin: 0 1rem 1.5rem;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }

  .savings-section.hidden {
    display: none;
  }

  .savings-highlight {
    font-size: 1.25rem;
    color: var(--text);
    margin: 0;
  }

  .savings-highlight .amount {
    font-size: 2rem;
    font-weight: 700;
    color: var(--success);
  }

  .alternative-section {
    padding: 2rem 1rem;
    max-width: 900px;
    margin: 0 auto;
  }

  .alternative-section h2 {
    font-size: 1.5rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
  }

  .alt-intro {
    color: var(--muted);
    margin-bottom: 1.5rem;
  }

  .alt-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  @media (min-width: 640px) {
    .alt-options {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .alt-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem;
  }

  .alt-card h3 {
    font-size: 1.1rem;
    font-weight: 700;
    margin: 0 0 0.5rem 0;
    color: var(--success);
  }

  .alt-card p {
    font-size: 0.9rem;
    color: var(--muted);
    margin: 0 0 1rem 0;
  }

  .alt-link {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--success);
  }

  .share-section {
    padding: 2rem 1rem;
    max-width: 900px;
    margin: 0 auto;
    border-top: 1px solid var(--border);
  }

  .step-header {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    background: linear-gradient(135deg, #dc2626, #f97316);
    color: white;
    font-weight: 700;
    font-size: 1.25rem;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .step-info {
    flex: 1;
  }

  .step-title {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 800;
    color: var(--text);
  }

  .step-desc {
    margin: 0.25rem 0 0 0;
    font-size: 0.9rem;
    color: var(--muted);
  }

  .share-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  .share-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: transform 0.1s, opacity 0.2s;
  }

  .share-btn:hover {
    transform: scale(1.02);
    text-decoration: none;
  }

  .share-btn svg {
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
  }

  .share-whatsapp {
    background: #25D366;
    color: white;
  }

  .share-sms {
    background: #34C759;
    color: white;
  }

  .share-email {
    background: var(--accent);
    color: white;
  }

  .share-copy {
    background: var(--card-bg);
    color: var(--text);
    border: 1px solid var(--border);
  }

  .share-text {
    position: absolute;
    left: -9999px;
  }

  .share-feedback {
    display: block;
    margin-top: 0.75rem;
    color: var(--success);
    font-weight: 500;
  }

  .share-feedback.hidden {
    display: none;
  }

  .back-link {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border);
  }

  .back-link a {
    color: var(--muted);
    font-size: 0.95rem;
  }

  .back-link a:hover {
    color: var(--accent);
  }

  /* Screen reader only */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>

<script>
  const checkboxes = document.querySelectorAll<HTMLInputElement>('.service-checkbox input');
  const checkboxLabels = document.querySelectorAll('.service-checkbox');
  const savingsSection = document.querySelector('.savings-section');
  const shareTextEl = document.getElementById('share-text');
  const shareWhatsApp = document.getElementById('share-whatsapp');
  const shareSMS = document.getElementById('share-sms');
  const shareEmail = document.getElementById('share-email');
  const shareCopy = document.getElementById('share-copy');
  const shareFeedback = document.getElementById('share-feedback');

  let currentDisplayedAmount = 0;
  let animationFrame: number | null = null;

  function formatMoney(amount: number): string {
    return '$' + amount.toLocaleString('en-US');
  }

  function animateCounter(targetAmount: number, element: HTMLElement | null, suffix: string = '') {
    if (!element) return;

    const startAmount = currentDisplayedAmount;
    const diff = targetAmount - startAmount;
    const duration = 400;
    const startTime = performance.now();

    if (animationFrame) cancelAnimationFrame(animationFrame);

    function update(currentTime: number) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const easeOut = 1 - Math.pow(1 - progress, 3);
      const current = Math.round(startAmount + diff * easeOut);

      element.textContent = `${formatMoney(current)}${suffix}`;

      if (progress < 1) {
        animationFrame = requestAnimationFrame(update);
      } else {
        currentDisplayedAmount = targetAmount;
      }
    }

    animationFrame = requestAnimationFrame(update);
  }

  function updateResults() {
    const selected = new Set<string>();
    let totalMonthly = 0;

    checkboxes.forEach((cb, index) => {
      const label = checkboxLabels[index];
      const serviceItem = label?.closest('.service-item');
      const inlineSteps = serviceItem?.querySelector('.inline-steps');

      if (cb.checked) {
        selected.add(cb.value);
        totalMonthly += parseFloat(cb.dataset.price || '0');
        label?.classList.add('selected');
        inlineSteps?.classList.remove('hidden');
      } else {
        label?.classList.remove('selected');
        inlineSteps?.classList.add('hidden');
      }
    });

    const hasSelection = selected.size > 0;
    const annual = Math.round(totalMonthly * 12);

    savingsSection?.classList.toggle('hidden', !hasSelection || annual === 0);

    const annualSavingsEl = document.getElementById('annual-savings');

    if (annual > 0) {
      animateCounter(annual, annualSavingsEl, '/year');
      if (shareTextEl) {
        shareTextEl.textContent = `I'm joining the AI strike—taking back ${formatMoney(annual)}/year. No more ChatGPT, Gemini, or Copilot. Run local instead: ollama.ai. Join me: https://defundbillionaires.org/defund-ai`;
      }
    } else {
      currentDisplayedAmount = 0;
      if (annualSavingsEl) annualSavingsEl.textContent = '$0/year';
    }

    updateShareLinks();
  }

  checkboxes.forEach((cb) => {
    cb.addEventListener('change', updateResults);
  });

  function updateShareLinks() {
    const text = shareTextEl?.textContent || '';
    const encodedText = encodeURIComponent(text);
    const subject = encodeURIComponent('Join the AI Strike');

    if (shareWhatsApp) {
      (shareWhatsApp as HTMLAnchorElement).href = `https://wa.me/?text=${encodedText}`;
    }
    if (shareSMS) {
      (shareSMS as HTMLAnchorElement).href = `sms:?&body=${encodedText}`;
    }
    if (shareEmail) {
      (shareEmail as HTMLAnchorElement).href = `mailto:?subject=${subject}&body=${encodedText}`;
    }
  }

  shareCopy?.addEventListener('click', async () => {
    const text = shareTextEl?.textContent || '';
    try {
      await navigator.clipboard.writeText(text);
      shareFeedback?.classList.remove('hidden');
      setTimeout(() => {
        shareFeedback?.classList.add('hidden');
      }, 3000);
    } catch (err) {
      console.error('Failed to copy:', err);
    }
  });

  updateShareLinks();
</script>
